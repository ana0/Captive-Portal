<!DOCTYPE html>
<html>
    <head>
        <title>three.js css3d - panorama - deviceorientation</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <style>
            body {
                background-color: #000000;
                margin: 0;
                cursor: move;
                overflow: hidden;
            }
            a {
                color: #ffffff;
            }
            h1 {
                font-family: TimesNewRoman, "Times New Roman", Times, Baskerville, Georgia, serif;
                color: #ffffff;
                font-size: 12pt;
                -webkit-font-smoothing: antialiased;
            }
            table {
                width: 100%;
                margin-top: 10px;
            }
            table p {
                font-size: 10pt;
/*                padding-left: 10px;*/
                margin: 0px;
            }
            table span {
                font-size: 10pt;
                padding-left: 10px;
                margin: 0px;
                position: absolute;
                display: inline-block;
            }
            button {
                background-color: #d80e09;
                font-family: TimesNewRoman, "Times New Roman", Times, Baskerville, Georgia, serif;
                color: #ffffff;
                border: none;
                padding-left: 20px;
                padding-right: 20px;
                -webkit-font-smoothing: antialiased;
            }
            .logo {
                width: 50px;
                height: auto;
                margin: 5px;
                display: inline-block;
            }
            input[type=text] {
                width: 95%;
                border: 1px solid #59a4e2;
            }
            input[type=checkbox] {
                border: 1px solid #59a4e2;
                -webkit-appearance: none;
                background: #ffffff;
                width: 15px;
                height: 15px;
                margin: 0px;
                text-align: center;
                outline-offset: 0;
            }
            input[type=checkbox]:checked:after {
                content: '✓';
                outline-offset: 0;
            }
            .formH1 {
                display: inline-block;
                position: absolute;
                padding-left: 10px;
            }
            .formHeading {
                background-color: #0e2c70;
                padding: 5px;
            }

            .formBody {
                background-color: #eadfdf;
                display: block;
                padding: 10px;
            }
            .mandatory {
                background-color: #000000;
                text-align: center;
                padding: 5px;
            }
            .mandatory p {
                font-family: TimesNewRoman, "Times New Roman", Times, Baskerville, Georgia, serif;
                color: #ffffff;
                font-size: 10pt;
            }
            tr.tableHeader > td {
                border-bottom: 1px solid #000000;
                margin-bottom: 5px;
            }
            tr.spaceAbove > td {
                padding-top: 10px;
            }
            #info {
                position: absolute;
                width: 100%;
                color: #ffffff;
                padding: 5px;
                font-family: Monospace;
                font-size: 13px;
                font-weight: bold;
                text-align: center;
                z-index: 1;
            }
            #formPageOneEng, #formPageOneHeb, #successEng, #successHeb, #failEng, #failHeb {
                display: none;
                background-color: #ffffff;
                position: fixed;
                top: 0px;
                z-index: 20;
            }
            #digEng, #digHeb {
                display: none;
                background-color: #000000;
                position: fixed;
                top: 0px;
                z-index: 20;    
                color: #1cef3c;
                font-family: "Lucida Console", Monaco, monospace;
                font-size: 10pt;
                padding: 10px;           
            }
            .crimRecordExt, .arrestExt {
                display: none;
            }
            .message {
                background-color: #ffffff;
                font-size: 8pt;
                border: 2px solid #000000;
                font-family: "Lucida Console", Monaco, monospace;
                padding:0px 10px 0px 10px;
                border-radius: 10px;
            }
            .yesButton {
                background-color: #ffffff;
                font-size: 8pt;
                border: 2px solid #000000;
                float: left;
                margin-bottom: 10px;
                color: #000000;
                border-radius: 5px;
                font-family: "Lucida Console", Monaco, monospace;
            }
            .noButton {
                background-color: #ffffff;
                font-size: 8pt;
                border: 2px solid #000000;
                float: right;
                margin-bottom: 10px;
                color: #000000;
                border-radius: 5px;
                font-family: "Lucida Console", Monaco, monospace;
            }
        </style>
    </head>
    <body>
        
        <script src="js/third-party/threejs/three.js"></script>
        <script src="js/third-party/threejs/DeviceOrientationControls.js"></script>
        <script src="js/third-party/threejs/CSS3DRenderer.js"></script>
        <script src="js/third-party/threejs/OrbitControls.js"></script>

        <script>
            //@to-do comment this, divide it into logical sections
            //@to-do move most css into style section

            var camera, scene, renderer;
            var geometry, material, mesh;
            var language = 'Eng';
            init();
            animate();


            function init() {
                camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 1000);

                controls = new THREE.OrbitControls(camera, element);
                controls.rotateUp(Math.PI / 4);
                controls.target.set(
                    camera.position.x + 0.1,
                    camera.position.y,
                    camera.position.z
                );
                controls.noZoom = true;
                controls.noPan = true;

                function setOrientationControls(e) {
                    if (!e.alpha) {
                         return;
                    }

                    controls = new THREE.DeviceOrientationControls(camera, true);
                    controls.connect();
                    controls.update();

                    element.addEventListener('click', fullscreen, false);

                    window.removeEventListener('deviceorientation', setOrientationControls, true);
                }

                window.addEventListener('deviceorientation', setOrientationControls, true);

                var toRadians = function(degree) {
                    return degree*(Math.PI/180);}
                
                scene = new THREE.Scene();
                var sides = [
                    {
                        url: 'textures/cube/Wall/3posx.jpg',
                        position: [ -512, 0, 0 ],
                        rotation: [ 0, Math.PI / 2, 0 ]
                    },
                    {
                        url: 'textures/cube/Wall/3negx.jpg',
                        position: [ 512, 0, 0 ],
                        rotation: [ 0, -Math.PI / 2, 0 ]
                    },
                    {
                        url: 'textures/cube/Wall/3posy.jpg',
                        position: [ 0,  512, 0 ],
                        rotation: [ Math.PI / 2, 0, Math.PI ]
                    },
                    {
                        url: 'textures/cube/Wall/2negy.jpg',
                        position: [ 0, -512, 0 ],
                        rotation: [ - Math.PI / 2, 0, Math.PI ]
                    },
                    {
                        url: 'textures/cube/Wall/4negz.jpg',
                        position: [ 0, 0,  512 ],
                        rotation: [ 0, Math.PI, 0 ]
                    },
                    {
                        url: 'textures/cube/Wall/4posz.jpg',
                        position: [ 0, 0, -512 ],
                        rotation: [ 0, 0, 0 ]
                    }
                ];
                var cube = new THREE.Object3D();
                scene.add(cube);
                for ( var i = 0; i < sides.length; i ++ ) {
                    var side = sides[ i ];
                    var element = document.createElement('img');
                    element.width = 1026; // 2 pixels extra to close the gap.
                    element.src = side.url;
                    var object = new THREE.CSS3DObject(element);
                    object.position.fromArray(side.position);
                    object.rotation.fromArray(side.rotation);
                    cube.add(object);
                }

                var languageSelectionMenu = document.createElement('div');
                languageSelectionMenu.style.width = '400px';
                languageSelectionMenu.style.backgroundColor = 'rgba(234, 223, 223, 0.7)';

                var languageHeading = document.createElement('div');
                languageHeading.className = 'formHeading';
                var languageLogo = document.createElement('img');
                languageLogo.src = 'textures/logo.png';
                languageLogo.className = 'logo';
                languageHeading.appendChild(languageLogo);
                languageH1 = document.createElement('div');
                languageH1.className = 'formH1';
                languageH1.innerHTML = '<h1>C. P. Customs and <br>Border Protection</h1>';
                languageHeading.appendChild(languageH1);
                languageSelectionMenu.appendChild(languageHeading);

                var languageBody = document.createElement('div');
                languageBody.style.padding = '10px';
                languageBody.style.height = '100px';
                languageSelectionMenu.appendChild(languageBody);

                var englishButton = document.createElement('button');
                englishButton.innerHTML = 'English';
                englishButton.style.position = 'absolute';
                englishButton.style.left = '20px';
                englishButton.style.backgroundColor = '#000000';
                englishButton.style.marginBottom = '20px';
                englishButton.onclick = function() {showEnglishFormOne()};
                languageBody.appendChild(englishButton);

                var hebrewButton = document.createElement('button');
                hebrewButton.innerHTML = 'עִברִית';
                hebrewButton.style.position = 'absolute';
                hebrewButton.style.right = '20px';
                hebrewButton.style.backgroundColor = '#000000'
                hebrewButton.style.marginBottom = '30px';
                hebrewButton.onclick = function() {showHebrewFormOne()};
                languageBody.appendChild(hebrewButton);

                var proceedButton = document.createElement('button');
                proceedButton.innerHTML = 'Proceed';
                proceedButton.style.position = 'absolute';
                proceedButton.style.right = '30px';
                proceedButton.style.bottom = '10px';
                proceedButton.style.marginBottom = '10px';
                proceedButton.onclick = function() {proceedToForm()};
                languageBody.appendChild(proceedButton);

                var languageSelectionBox = new THREE.CSS3DObject(languageSelectionMenu);
                languageSelectionBox.position.set(0, 0, 512);
                languageSelectionBox.rotation.set(0, Math.PI, 0);
                scene.add(languageSelectionBox);

                var showEnglishFormOne = function() {
                    language = 'Eng';
                    languageSelectionMenu.removeAttribute('dir');
                    languageH1.innerHTML = '<h1>C. P. Customs and <br>Border Protection</h1>';
                    proceedButton.innerHTML = 'Proceed';
                }

                var showHebrewFormOne = function() {
                    language = 'Heb';
                    languageSelectionMenu.setAttribute('dir', 'rtl');
                    languageH1.innerHTML = '<h1>ג פ מכס<br>והגנת גבולות</h1>';
                    proceedButton.innerHTML = 'לְהִתְקַדֵם';
                }

                var proceedToForm = function() {
                    languageSelectionMenu.style.display = 'none';
                    var formPageOne = document.getElementById("formPageOne" + language);
                    formPageOne.style.display = 'block';
                    formPageOne.style.width = String(window.innerWidth) + 'px';
                    formPageOne.style.height = String(window.innerHeight) + 'px';
                }

                var shovelInfo = document.createElement('div');
                var shovelIcon = document.createElement('img');
                shovelIcon.src = 'textures/pointer.gif';
                shovelIcon.onclick = function() {showMessage('You have found a shovel<br> . . would you like to dig?', 'מצאת את חפירה<br> . . אתה רוצה לחפור?', shovelInfo, shovelChoice)};
                shovelInfo.appendChild(shovelIcon);

                var shovelBox = new THREE.CSS3DObject(shovelInfo);
                shovelBox.position.set(-200, -312, -200);
                var xRotation = toRadians(-215);
                var yRotation = toRadians(135);
                var zRotation = toRadians(-135);
                shovelBox.rotation.set(xRotation, yRotation, zRotation);
                scene.add(shovelBox);

                var yesButton = document.createElement('button');
                yesButton.onclick = function() {};

                var noButton = document.createElement('button');
                noButton.onclick = function() {};

                var showMessage = function(engMessage, hebMessage, divToChange, callback) {
                    if (language === 'Eng') {
                        divToChange.removeAttribute('dir');
                        divToChange.innerHTML = '<p>'+ engMessage + '</p>';
                    } else {
                        divToChange.setAttribute('dir', 'rtl');
                        divToChange.innerHTML = '<p>'+ hebMessage + '</p>';
                    }
                    divToChange.className = 'message';
                    callback();
                }

                var shovelChoice = function() {
                    if (language === 'Eng') {
                        yesButton.removeAttribute('dir');
                        yesButton.innerHTML = 'Yes';
                        noButton.removeAttribute('dir');
                        noButton.innerHTML = 'No';
                    } else {
                        yesButton.setAttribute('dir', 'rtl');
                        yesButton.innerHTML = 'כן';
                        noButton.setAttribute('dir', 'rtl');
                        noButton.innerHTML = 'לא';
                    }
                    yesButton.className = 'yesButton';
                    noButton.className = 'noButton';
                    shovelInfo.appendChild(yesButton);
                    yesButton.onclick = function() {dig()};
                    shovelInfo.appendChild(noButton);
                    noButton.onclick = function() {dontDig()};
                }

                var dig = function() {
                    showMessage('You dig. The sand is heavy and your shoulders<br> begin to ache, but you continue anyway.</p><p>Suddenly, your shovel hits something. Something hard.<br>     . . . Do you want to keep digging?', 'אתה לחפור. החול הוא כבד והכתפיים מתחילות לכאוב, אבל אתה ממשיך בכל זאת.</p><p>פתאום, את חפירת רגלכם משהו. משהו קשה<br>     . . . האם אתה רוצה להמשיFך לחפור?', shovelInfo, continueDig)
                }

                var continueDig = function() {
                    shovelChoice();
                    yesButton.onclick = function() {
                        console.log("continue dig")
                        var diggingConsole = document.getElementById('dig' + language);
                        console.log(diggingConsole);
                        diggingConsole.style.display = 'block';
                        diggingConsole.style.width = String(window.innerWidth) + 'px';
                        diggingConsole.style.height = String(window.innerHeight) + 'px';
                    }
                }

                var dontDig = function() {
                    shovelInfo.style.display = 'none';
                }

                renderer = new THREE.CSS3DRenderer();
                renderer.setSize(window.innerWidth, window.innerHeight);
                document.body.appendChild(renderer.domElement);
                window.addEventListener('resize', onWindowResize, false);
            }
            function onWindowResize() {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }
            function animate() {
                requestAnimationFrame(animate);
                controls.update();
                renderer.render(scene, camera);
            }
            function update(dt) {
                resize();
                camera.updateProjectionMatrix();
                controls.update(dt);
            }

        </script>
    <div id="formPageOneEng">
        <div class="formHeading">
            <img src='textures/logo.png' class="logo">
            <div class="formH1"><h1>C. P. Customs and <br>Border Protection</h1></div>
        </div>
        <div class="formBody">
            <div class="mandatory">
                <p>ALL FIELDS ARE MANDATORY</p>
                <p>Falsifying or witholding information on this document is a federal offence</p>
            </div>
            <table>
                <tr class="tableHeader">
                    <td colspan="3"><p>Identity</p></td>
                </tr>
                <tr class="spaceAbove">
                    <td><p>Date of Birth</p></td>
                    <td><p>Country of Birth</p></td>
                </tr>
                <tr>
                    <td><input class="textInput" type="text"\></td>
                    <td><input class="textInput" type="text"\></td>
                </tr>
                <tr class="spaceAbove">
                    <td><p>Gender</p></td>
                    <td><p>Sexual Orientation</p></td>
                </tr>
                <tr>
                    <td><input class="textInput" type="text"\></td>
                    <td><input class="textInput" type="text"\></td>
                </tr>
                <tr class="spaceAbove">
                    <td><p>Religious Affiliation</p></td>
                    <td><p>Race/Ethnicity</p></td>
                </tr>
                <tr>
                    <td><input class="textInput" type="text"\></td>
                    <td><input class="textInput" type="text"\></td>
                </tr>
                <tr class="spaceAbove">
                    <td colspan="2"><input class="crimRecord" type="checkbox"></input><span>Do you have a criminal record?</span></td>
                </tr>
                <tr class="spaceAbove, crimRecordExt">
                    <td colspan="2"><p>What is the nature of the charges?</p></td>
                </tr>
                <tr class="crimRecordExt">
                    <td colspan="2"><input class="textInput" type="text"\></td>
                </tr>
                <tr class="spaceAbove">
                    <td colspan="2"><input class="arrest" type="checkbox"\><span>Have you ever been arrested?</span></td>
                </tr>
                <tr class="spaceAbove, arrestExt">
                    <td colspan="2"><p>For what??</p></td>
                </tr>
                <tr class="arrestExt">
                    <td colspan="2"><input class="textInput" type="text"\></td>
                </tr>
            </table>
            <button id="contEng">Submit</button>
        </div>
    </div>
    <div dir="rtl" id="formPageOneHeb">
        <div class="formHeading">
            <h1>ג פ המכס והגנת הגבולות</h1>
        </div>
        <div class="formBody">
            <div class="mandatory">
                <p>כל השדות הם חובה</p>
                <p>זיוף או במקור מידע על מסמך זה הוא עבירה פדרלית</p>
            </div>
            <table>
                <tr>
                    <td class="tableHeader" colspan="2"><p>זהות</p></td>
                </tr>
                <tr>
                    <td>ok</td>
                    <td>wt</td>
                </tr>
            </table>
            <button id="contHeb">שלח</button>
        </div>
    </div>
    <div id="successEng"></div>
    <div id="successHeb" dir="rtl"></div>

    <div id="failEng"></div>
    <div id="failHeb" dir="rtl"></div>

    <div id="digEng"><p>You stab the shovel as hard as you can into the bottom of the hole, and you hear a noise like glass breaking. <br><br><br>
        You can't see anything down here in the hole anymore but you keep digging.  <br>The sand begins to feel . . . lighter.<br><br><br>
        You continue digging. <br><br><br>
        The sand is  . . . . weightless. You begin to wonder if you're digging anything at all.  <br>Is it just you and the darkness down here, swinging a shovel around?<br><br><br>
        You think you see something moving . . . glowing faintly. <br><br><br><br><br>
        Configuring ISP PNP<br>
        Setting system time from the hardware clock (localtime).<br>
        Using /etc/random-seed to initialize /dev/urandom.<br>
        Initializing basic system settings . . .<br>
        Updating shared libraries<br>
        Setting hostname: Anon512<br>
        No devices found<br>
        Checking filesystems<br>
        INIT: Entering runlevel: 4<br>
        Checking for hardware changes<br>
        rc.M ==> Going multiuser . . .<br>
        Starting system logger . . .<br>
        Initializing advanced hardware<br>
        Setting up modules<br>
        Initializing network<br>
        Setting up localhost . . .<br>
        Setting up inet1 . . . .<br>
        Setting up route <br>
        Setting up console and GUI<br>
        Loading fc-cache . . .<br>
        rc.vlinit ==> Going to runlevel 4<br>
        Starting dnsmasq . . .<br>
        Bringing up interface wlan0:<br>
        Determining IP information for wlan0 . . . done.<br></p>
        </div>
    <div id="digHeb" dir="rtl"></div>
    <script>
        var contEng = document.getElementById("contEng");
        contEng.onclick = function() {};

        var contHeb = document.getElementById("contHeb");
        contHeb.onclick = function() {};

        var getFormExtensions = function() {
            return document.querySelectorAll('input[type=checkbox]:checked');
        }

        var formExtensions = getFormExtensions();

        var checkboxes = document.querySelectorAll('input[type=checkbox]');
        for (i = 0; i < checkboxes.length; i++) {
            checkboxes[i].onchange = function() {
                checkFormExtensions(checkboxes[i])
            };
        }

        var checkFormExtensions = function(clickedCheckbox) {
            console.log("called checkFormExtensions");
            console.log(clickedCheckbox);
            formExtensions = getFormExtensions()
            for (i = 0; i < formExtensions.length; i++) {
                if (formExtensions[i] === clickedCheckbox) {
                    showExtensionElements(clickedCheckbox);
                } else {
                    hideExtensionElements(clickedCheckbox);
                }
            }
        }

        var showExtensionElements = function(clickedCheckbox) {
            console.log("called showExtensionElements");
            console.log(clickedCheckbox);
            var classToExtend = "." + String(clickedCheckbox.className) + 'Ext';
            console.log(classToExtend);
            var extensions = document.querySelectorAll(classToExtend);
            console.log(extensions)
            for (i = 0; i < extensions.length; i++) {
                extensions[i].style.display = 'table-row';
            }
        }

        var hideExtensionElements = function(clickedCheckbox) {
            console.log("called showExtensionElements");
            console.log(clickedCheckbox);
            var classToUnextend = "." + String(clickedCheckbox.className) + 'Ext';
            console.log(classToExtend);
            var extensions = document.querySelectorAll(classToUnextend);
            console.log(extensions)
            for (i = 0; i < extensions.length; i++) {
                extensions[i].style.display = 'none';
            }
        }

        var formExtensions = document.querySelectorAll('input[type=checkbox]:checked');
        for (i = 0; i < formExtensions.length; i++) {
            console.log("ok");
            console.log(formExtensions[i]);
        }
    </script>
    </body>
</html>